<!DOCTYPE html>
<html>
	<head>
		<meta charset='utf-8' />
		<style>
			/** TODO: adicionar o reset */
			#ball {
				width: 10px; height: 10px;
				border-radius: 10px;
				background: #000;
				transition: top, left;
			}

			html, body, #board {
				width: 100%; height: 100%;
				border: 0; padding: 0; margin: 0;
			}
		</style>
	</head>
	<body>
		<div id='board'>
			<div id='ball'></div>
		</div>
		<script>
			var acceleration = [0, 0], intervalMilliseconds = 50, intervalSeconds = 0;

			var ball = {
				dom: document.getElementById('ball'),
								// x, y
				velocity: [0, 0],
				position: [0, 0]
			}

                        function handleOrientation(event) {
                                var x = event.beta;  // In degree in the range [-180,180]
                                var y = event.gamma; // In degree in the range [-90,90]

                                output.innerHTML  = "beta : " + x + "\n";
                                output.innerHTML += "gamma: " + y + "\n";

                                // Because we don't want to have the device upside down
                                // We constrain the x value to the range [-90,90]
                                if (x >  90) { x =  90};
                                if (x < -90) { x = -90};

                                // To make computation easier we shift the range of 
                                // x and y to [0,180]
                                x += 90;
                                y += 90;

                                // 10 is half the size of the ball
                                // It center the positionning point to the center of the ball
                                ball.style.top  = (maxX*x/180 - 10) + "px";
                                ball.style.left = (maxY*y/180 - 10) + "px";
                        }

			function initDesktop() {
				document.addEventListener('keyup', function(evt) {
					if (evt.keyCode == evt.DOM_VK_RIGHT) {
						acceleration[0] += 1;
					}
					else if (evt.keyCode == evt.DOM_VK_LEFT) {
						acceleration[0] -= 1;
					}
					else if (evt.keyCode == evt.DOM_VK_UP) {
						acceleration[1] -= 1;
					}
					else if (evt.keyCode == evt.DOM_VK_DOWN) {
						acceleration[1] += 1;
					}
				});
			}

			function update() {
				ball.dom.style.left = ball.position[0] + 'px';
				ball.dom.style.top = ball.position[1] + 'px';
			}

			function hit(ball) {
				// TODO:
				return false;
			}

			function loop() {
				ball.position[0] += ball.velocity[0] * intervalSeconds + (intervalSeconds * acceleration[0]) / 2;
				ball.position[1] += ball.velocity[1] * intervalSeconds + (intervalSeconds * acceleration[1]) / 2;

				ball.velocity[0] += intervalSeconds * acceleration[0];
				ball.velocity[1] += intervalSeconds * acceleration[1];

				// TODO: take angle into consideration
				if (hit(ball)) {
					acceleration = [0, 0];
					ball.velocity = [0, 0];
				}

				update();
			}

                        function initMobile() {
                            window.addEventListener('devicemotion', function(event) {
                                console.log(event.acceleration.x + ' m/s2');
                            });
   //                             window.addEventListener('deviceorientation', handleOrientation);
                        }

			function initTimer() {
				// window.mozRequestAnimationFrame();
				window.setInterval(loop, intervalMilliseconds);
			}

			function initElements() {
				ball.dom.parentElement.style.position = 'relative';
				ball.dom.style.position = 'absolute';
			}
			
			window.onload = function() {
				intervalSeconds = intervalMilliseconds / 1000;
				initElements();
				//initDesktop();
                                initMobile();
				initTimer();
			}
		</script>
	</body>
</html>
